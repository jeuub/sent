(this.webpackJsonpclient1=this.webpackJsonpclient1||[]).push([[0],{167:function(e,t,n){},169:function(e,t,n){},171:function(e,t,n){},172:function(e,t,n){},173:function(e,t,n){},174:function(e,t,n){},175:function(e,t,n){},176:function(e,t,n){"use strict";n.r(t);var c,r,a,i,s,o,l,d,j=n(0),u=n(59),b=n.n(u),h=n(32),O=n.n(h),f=n(33),m=n(17),p=n(68),v=n(20),x=n.n(v),g=n(7),k=(n(166),n(51)),y=n(199),w=n(202),S=n(178),_=n(203),C=n(200),N=n(79),I=(n(167),n(4)),U=function(e){var t=e.id,n=e.go,c=e.fetchedUser;return Object(j.useEffect)((function(){localStorage.getItem("sent-token")&&n("greeting")}),[]),Object(I.jsxs)(g.r,{id:t,className:"home-panel",children:[c&&Object(I.jsxs)(g.m,{className:"home-panel__greeting",children:[Object(I.jsxs)(g.F,{level:"1",weight:"semibold",style:{marginBottom:16},children:[Object(I.jsxs)("strong",{children:[c.first_name," ",c.last_name]}),",",Object(I.jsx)("br",{}),"\u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u043c \u0442\u0435\u0431\u044f \u0432 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0438 ",Object(I.jsx)("span",{children:"SENT"}),"."]}),Object(I.jsx)(g.g,{before:c.photo_200?Object(I.jsx)(g.c,{src:c.photo_200}):null})]}),Object(I.jsxs)(g.m,{className:"home-panel__actions",children:[Object(I.jsx)(g.d,{stretched:!0,size:"l",mode:"secondary",onClick:function(){return n("login")},children:"\u041d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c sent."}),Object(I.jsx)(g.d,{stretched:!0,size:"l",mode:"secondary",onClick:function(){return localStorage.clear()},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435"})]})]})},E=(n(169),n(36)),$=n(201),A=Object($.a)(c||(c=Object(E.a)(["\n  mutation signUp($username: String!, $vkid: String!) {\n    signUp(username: $username, vkid: $vkid)\n  }\n"]))),z=Object($.a)(r||(r=Object(E.a)(["\n  mutation signIn($username: String!, $vkid: String!) {\n    signIn(username: $username, vkid: $vkid)\n  }\n"]))),q=Object($.a)(a||(a=Object(E.a)(["\n  mutation hasAccount($vkid: String!) {\n    hasAccount(vkid: $vkid)\n  }\n"]))),B=Object($.a)(i||(i=Object(E.a)(["\n  mutation newNote($content: String!) {\n    newNote(content: $content) {\n      content\n      id\n      author {\n        username\n      }\n    }\n  }\n"]))),F=Object($.a)(s||(s=Object(E.a)(["\n  mutation Mutation($toggleFavoriteId: ID!) {\n    toggleFavorite(id: $toggleFavoriteId) {\n      favoriteCount\n    }\n  }\n"]))),P=n(185),D=function(e){var t=e.id,n=e.go,c=e.fetchedUser,r=Object(P.a)(q),a=Object(m.a)(r,1)[0],i=Object(P.a)(z),s=Object(m.a)(i,1)[0],o=Object(P.a)(A),l=Object(m.a)(o,1)[0],d=Object(j.useState)(""),u=Object(m.a)(d,2),b=u[0],h=u[1],O=!1,p=function(){var e=Object(f.a)(x.a.mark((function e(){var t,n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a({variables:{vkid:"".concat(c.id)}});case 3:return n=e.sent,e.abrupt("return",null===(t=n.data)||void 0===t?void 0:t.hasAccount);case 7:e.prev=7,e.t0=e.catch(0),h(String(e.t0)||"");case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),v=function(){var e=Object(f.a)(x.a.mark((function e(){var t,n,r;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s({variables:{username:"".concat(c.first_name," ").concat(c.last_name),vkid:"".concat(c.id)}});case 3:return r=e.sent,localStorage.setItem("sent-token",null===(t=r.data)||void 0===t?void 0:t.signIn),O=!0,e.abrupt("return",null===(n=r.data)||void 0===n?void 0:n.signIn);case 9:e.prev=9,e.t0=e.catch(0),h(String(e.t0)||"");case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=Object(f.a)(x.a.mark((function e(){var t,n,r;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l({variables:{username:"".concat(c.first_name," ").concat(c.last_name),vkid:"".concat(c.id)}});case 3:return r=e.sent,localStorage.setItem("sent-token",null===(t=r.data)||void 0===t?void 0:t.signIn),O=!0,e.abrupt("return",null===(n=r.data)||void 0===n?void 0:n.signUp);case 9:e.prev=9,e.t0=e.catch(0),h(String(e.t0)||"");case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),y=function(){var e=Object(f.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p();case 2:e.sent?v():k();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(j.useEffect)((function(){c&&(O=!!localStorage.getItem("sent-token"),y(),O&&n("greeting"))}),[c]),Object(I.jsx)(g.r,{id:t,className:"login__panel",children:Object(I.jsxs)("div",{className:"login__spinner-wrapper",children:[Object(I.jsx)(g.z,{size:"large",style:{margin:"20px 0"}}),b||null]})})},H=Object($.a)(o||(o=Object(E.a)(["\n  query Query {\n    noteFeed {\n      notes {\n        id\n        content\n        author {\n          username\n          id\n          vkid\n        }\n        createdAt\n        favoriteCount\n        favoritedBy {\n          vkid\n        }\n      }\n      cursor\n      hasNextPage\n    }\n  }\n"]))),T=Object($.a)(l||(l=Object(E.a)(["\n  query myNote {\n    me {\n      notes {\n        content\n      }\n    }\n  }\n"]))),V=Object($.a)(d||(d=Object(E.a)(["\n  query mySent {\n    me {\n      username\n      notes {\n        content\n        favoriteCount\n        favoritedBy {\n          username\n          vkid\n        }\n      }\n    }\n  }\n"]))),G=n(78),K=n(190),L=(n(171),function(e){var t,n,c=e.id,r=(e.fetchedUser,e.go),a=Object(j.useState)(""),i=Object(m.a)(a,2),s=i[0],o=i[1],l=Object(P.a)(B),d=Object(m.a)(l,1)[0],u=Object(G.a)(T),b=u.loading,h=u.data,O=function(){var e=Object(f.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d({variables:{content:s}});case 3:r("main"),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.log("err");case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}();return null!==h&&void 0!==h&&null!==(t=h.me)&&void 0!==t&&t.notes.length&&r("main"),Object(I.jsx)(g.r,{id:c,children:b||null!==h&&void 0!==h&&null!==(n=h.me)&&void 0!==n&&n.notes.length?null:Object(I.jsxs)("div",{className:"main__container",children:[Object(I.jsxs)("div",{children:[Object(I.jsx)("h3",{className:"main__logo",children:"SENT."}),Object(I.jsxs)("h2",{children:["\u041e\u0434\u043d\u0430 \u0444\u0440\u0430\u0437\u0430 - \u043d\u0430 \u0432\u0441\u0435,",Object(I.jsx)("br",{})," \u043d\u0430\u0432\u0441\u0435\u0433\u0434\u0430."]})]}),Object(I.jsxs)("div",{className:"main__form form",children:[Object(I.jsxs)("div",{className:"form__content ",children:[Object(I.jsx)(g.l,{children:Object(I.jsx)(g.p,{type:"text",placeholder:"Your phrase",value:s,onChange:function(e){return o(e.target.value)}})}),Object(I.jsx)(g.d,{onClick:O,before:Object(I.jsx)(K.a,{}),size:"m"})]}),Object(I.jsxs)(g.d,{mode:"tertiary",size:"m",className:"form__later",stretched:!0,onClick:function(){return r("main")},children:[" ","\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0444\u0440\u0430\u0437\u0443 \u043f\u043e\u0437\u0436\u0435..."]})]})]})})}),Q=n(197),W=n(198),J=n(194),M=n(195),Y=n(196),R=n(193),X=n(191),Z=n(192),ee=(n(172),function(e){var t=e.fetchedUser,n=e.author,c=e.content,r=e.date,a=e.favoriteCount,i=e.favoritedBy,s=e.id,o=Object(P.a)(F),l=Object(m.a)(o,2),d=l[0],u=l[1],b=u.loading,h=(u.error,Object(j.useState)(!1)),O=Object(m.a)(h,2),p=O[0],v=O[1],k=Object(j.useState)(a),y=Object(m.a)(k,2),w=y[0],S=y[1];Object(j.useEffect)((function(){i.forEach((function(e){e.vkid==(null===t||void 0===t?void 0:t.id)&&v(!0)}))}),[]);var _=function(){var e=Object(f.a)(x.a.mark((function e(){var t,n,c;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d({variables:{toggleFavoriteId:s}});case 2:c=e.sent,S(null===c||void 0===c||null===(t=c.data)||void 0===t||null===(n=t.toggleFavorite)||void 0===n?void 0:n.favoriteCount),v(!p);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(I.jsxs)("figure",{className:"quote",children:[Object(I.jsx)("blockquote",{children:Object(I.jsx)("p",{children:c})}),Object(I.jsxs)("figcaption",{children:["\u2014",n.username,", ",["\u042f\u043d\u0432\u0430\u0440\u044c","\u0424\u0435\u0432\u0440\u0430\u043b\u044c","\u041c\u0430\u0440\u0442","\u0410\u043f\u0440\u0435\u043b\u044c","\u041c\u0430\u0439","\u0418\u044e\u043d\u044c","\u0418\u044e\u043b\u044c","\u0410\u0432\u0433\u0443\u0441\u0442","\u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c","\u041e\u043a\u0442\u044f\u0431\u0440\u044c","\u041d\u043e\u044f\u0431\u0440\u044c","\u0414\u0435\u043a\u0430\u0431\u0440\u044c"][r.getMonth()]," ",r.getFullYear()]}),Object(I.jsx)(g.d,{onClick:_,mode:p?"primary":"outline",loading:!!b,before:Object(I.jsx)(g.i,{mode:"primary",children:w}),children:p?Object(I.jsx)(X.a,{}):Object(I.jsx)(Z.a,{})})]})}),te=(n(173),function(e){var t,n,c=e.id,r=e.fetchedUser,a=Object(R.a)(H,{fetchPolicy:"no-cache"}),i=Object(m.a)(a,2),s=i[0],o=i[1],l=o.loading,d=(o.error,o.data);Object(j.useEffect)((function(){s()}),[]);var u=Object(j.useState)(!1),b=Object(m.a)(u,2),h=b[0],O=b[1],f=Object(j.useState)("all"),p=Object(m.a)(f,2),v=p[0],x=p[1];return Object(I.jsx)(g.H,{id:c,activePanel:c,children:Object(I.jsxs)(g.r,{id:c,children:[Object(I.jsx)(g.s,{right:Object(I.jsx)(g.t,{children:Object(I.jsx)(J.a,{})}),children:Object(I.jsx)(g.u,{onClick:function(){return O(!h)},aside:Object(I.jsx)(M.a,{style:{transform:"rotate(".concat(h?"180deg":"0",")")}}),children:"All sents."})}),Object(I.jsx)(g.v,{opened:h,onClose:function(){return O(!h)},children:Object(I.jsxs)(g.q,{children:[Object(I.jsx)(g.g,{after:"all"===v?Object(I.jsx)(Y.a,{fill:"var(--accent)"}):null,onClick:function(){x("all"),O(!1)},"data-mode":"all",children:"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435"}),Object(I.jsx)(g.g,{after:"managed"===v?Object(I.jsx)(Y.a,{fill:"var(--accent)"}):null,onClick:function(){x("managed"),O(!1)},"data-mode":"managed",children:"\u041f\u043e\u0438\u0441\u043a"})]})}),l?"loading":null===d||void 0===d||null===(t=d.noteFeed)||void 0===t||null===(n=t.notes)||void 0===n?void 0:n.map((function(e){return Object(I.jsx)(ee,{favoritedBy:e.favoritedBy,fetchedUser:r,author:e.author,content:e.content,date:new Date(e.createdAt),favoriteCount:e.favoriteCount,id:e.id},e.author.username)}))]})})}),ne=n.p+"static/media/quot.12352560.svg",ce=function(e){var t=e.id,n=Object(G.a)(V),c=n.loading,r=n.data;console.log(c,r);null===r||void 0===r||r.me.username;var a=null,i=null,s=null;if(null!==r&&void 0!==r&&r.me.notes.length){var o=null===r||void 0===r?void 0:r.me.notes[0];a=o.content,i=o.favoriteCount,o.favoritedBy,s=["https://picsum.photos/300/300/","https://picsum.photos/seed/300/300/","https://picsum.photos/id/1/300/300/","https://picsum.photos/id/2/300/300/","https://picsum.photos/id/3/300/300/","https://picsum.photos/id/4/300/300/","https://picsum.photos/id/5/300/300/","https://picsum.photos/id/6/300/300/","https://picsum.photos/id/7/300/300/"]}return Object(I.jsx)(g.H,{id:t,activePanel:t,children:Object(I.jsxs)(g.r,{id:t,children:[Object(I.jsx)(g.s,{children:"my sent."}),Object(I.jsxs)(g.m,{children:[Object(I.jsx)(g.n,{mode:"secondary",children:"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438"}),Object(I.jsx)(g.y,{disabled:!0,after:Object(I.jsx)(g.l,{children:Object(I.jsx)(g.x,{defaultValue:"auto",defaultChecked:!0,options:[{label:"\u043a\u0430\u043a \u0432 \u0412\u041a",value:"auto"},{label:"\u0441\u0432\u0435\u0442\u043b\u0430\u044f",value:"light"},{label:"\u0442\u0451\u043c\u043d\u0430\u044f",value:"dark"}]})}),children:"\u0422\u0435\u043c\u0430"}),Object(I.jsx)(g.y,{disabled:!0,after:Object(I.jsx)(g.C,{disabled:!0,"aria-label":"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f \u043e \u0440\u0435\u0441\u043f\u0435\u043a\u0442\u0430\u0445"}),children:"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f \u043e \u0440\u0435\u0441\u043f\u0435\u043a\u0442\u0430\u0445"}),Object(I.jsx)(g.y,{disabled:!0,after:Object(I.jsx)(g.C,{disabled:!0,"aria-label":"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f \u043e\u0431 \u043e\u0442\u0432\u0435\u0442\u0430\u0445"}),children:"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f \u043e\u0431 \u043e\u0442\u0432\u0435\u0442\u0430\u0445"})]}),c?Object(I.jsx)(g.z,{}):null!=a?Object(I.jsxs)(g.m,{mode:"plain",header:Object(I.jsx)(g.n,{mode:"secondary",children:"\u0424\u0440\u0430\u0437\u0430"}),children:[Object(I.jsx)(g.f,{size:"l",children:Object(I.jsxs)(g.e,{mode:"shadow",children:[Object(I.jsx)("img",{src:ne,alt:"Quotation mark",style:{width:"25px",float:"left",marginLeft:"10px",marginRight:"10px",marginTop:"5px"}}),Object(I.jsx)("blockquote",{style:{minHeight:"2rem",paddingTop:"5px"},children:a})]})}),Object(I.jsxs)(g.B,{style:{justifyContent:"center"},children:[Object(I.jsx)(g.A,{children:Object(I.jsx)(g.j,{children:Object(I.jsx)(g.o,{header:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u044b \u0444\u0440\u0430\u0437\u044b",children:"..."})})}),Object(I.jsx)(g.A,{children:Object(I.jsx)(g.j,{children:Object(I.jsx)(g.o,{header:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u044b \u043f\u0440\u043e\u0444\u0438\u043b\u044f",children:"..."})})})]}),Object(I.jsx)(g.y,{before:"\u0420\u0435\u0441\u043f\u0435\u043a\u0442\u044b: "+i,children:Object(I.jsx)(g.G,{style:{marginLeft:"1em"},photos:s||void 0,size:"m"})}),Object(I.jsx)(g.y,{children:"\u041e\u0442\u0432\u0435\u0442\u044b (\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u044e\u0442)"})]}):Object(I.jsx)(g.m,{mode:"plain",header:Object(I.jsx)(g.n,{mode:"secondary",children:"\u0424\u0440\u0430\u0437\u0430"}),children:Object(I.jsx)(g.d,{mode:"outline",children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0444\u0440\u0430\u0437\u0443"})}),Object(I.jsxs)(g.m,{children:[Object(I.jsx)("a",{style:{textDecoration:"none"},href:"http://pd-2021-2.std-1368.ist.mospolytech.ru/",target:"_blank",children:Object(I.jsx)(g.h,{children:"\u041e sent."})}),Object(I.jsx)(g.h,{mode:"danger",children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0430\u043a\u043a\u0430\u0443\u043d\u0442 (dev)"})]})]})})},re=(n(174),function(e){var t=e.fetchedUser,n=Object(j.useState)("all"),c=Object(m.a)(n,2),r=c[0],a=c[1];return Object(I.jsx)(g.r,{children:Object(I.jsxs)(g.k,{activeStory:r,tabbar:Object(I.jsxs)(g.D,{shadow:!1,children:[Object(I.jsx)(g.E,{selected:"all"===r,onClick:function(){return a("all")},text:"\u041d\u043e\u0432\u043e\u0441\u0442\u0438",children:Object(I.jsx)(Q.a,{})}),Object(I.jsx)(g.E,{selected:"my"===r,onClick:function(){return a("my")},text:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c",children:Object(I.jsx)(W.a,{})})]}),children:[Object(I.jsx)(te,{id:"all",fetchedUser:t}),Object(I.jsx)(ce,{id:"my"})]})})}),ae=Object(N.a)((function(e){var t=e.graphqlErrors;e.networkErrors;t&&t.map((function(e){var t=e.message;e.location,e.path;console.log("GraphQL error: ".concat(t))})),networkError&&console.log("[Network error]: ".concat(networkError))})),ie=new k.a((function(e,t){var n=localStorage.getItem("sent-token");return e.setContext((function(e){var t=e.headers,c=void 0===t?{}:t;return{headers:Object(p.a)(Object(p.a)({},c),{},{authorization:n||null})}})),t(e)})),se=Object(y.a)([ie,ae,new w.a({uri:"https://sent-server.herokuapp.com/api"})]),oe=new S.a({cache:new _.a,link:se,fetchOptions:{mode:"no-cors"}}),le=function(){var e=Object(j.useState)("login"),t=Object(m.a)(e,2),n=t[0],c=t[1],r=Object(j.useState)(null),a=Object(m.a)(r,2),i=a[0],s=a[1],o=Object(j.useState)(Object(I.jsx)(g.w,{size:"large"})),l=Object(m.a)(o,2),d=l[0],u=l[1];Object(j.useEffect)((function(){function e(){return(e=Object(f.a)(x.a.mark((function e(){var t;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.a.send("VKWebAppGetUserInfo");case 2:t=e.sent,s(t),u(null);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return O.a.subscribe((function(e){var t=e.detail,n=t.type,c=t.data;if("VKWebAppUpdateConfig"===n){var r=document.createAttribute("scheme");r.value=c.scheme?c.scheme:"client_light",document.body.attributes.setNamedItem(r)}})),function(){e.apply(this,arguments)}(),function(){routerUnsubscribe()}}),[]);var b=function(e){c(e)};return Object(I.jsx)(C.a,{client:oe,children:Object(I.jsx)(g.a,{children:Object(I.jsx)(g.b,{children:Object(I.jsxs)(g.H,{activePanel:n,popout:d,children:[Object(I.jsx)(U,{id:"home",fetchedUser:i,go:b}),Object(I.jsx)(D,{id:"login",fetchedUser:i,go:b}),Object(I.jsx)(L,{id:"greeting",fetchedUser:i,go:b}),Object(I.jsx)(re,{id:"main",fetchedUser:i,go:b})]})})})})};n(175);O.a.send("VKWebAppInit"),b.a.render(Object(I.jsx)(le,{}),document.getElementById("root"))}},[[176,1,2]]]);
//# sourceMappingURL=main.0b36b85e.chunk.js.map